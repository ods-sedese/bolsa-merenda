library(tidyverse)
library(openxlsx)
setwd("/srv/shiny-server/bolsa-merenda")
# Read db
pobre <- read.xlsx("data/Por_municipio_Nova_Sintese_Alunos_e_familias_pobres_contemplados_pelo_Bolsa_Merenda.xlsx")
ext_pobre <- read.xlsx("data/Por_municipio_Nova_Sintese_Alunos_e_familias_ext_pobres_contemplados_pelo_Bolsa_Merenda.xlsx")
mg_dados <- read.xlsx("data/mg_dados.xlsx") %>%
select(Código.IBGE, Município) %>%
rename(`Código IBGE` = Código.IBGE)
# Clean ext pobre
ext_pobre <- ext_pobre %>%
filter(!is.na(`Código IBGE`))
View(ext_pobre)
help(read.xlsx)
# Read db
pobre <- read.xlsx("data/Por_municipio_Nova_Sintese_Alunos_e_familias_pobres_contemplados_pelo_Bolsa_Merenda.xlsx", colNames = TRUE)
View(pobre)
# Read db
pobre <- read.xlsx("data/Por_municipio_Nova_Sintese_Alunos_e_familias_pobres_contemplados_pelo_Bolsa_Merenda.xlsx", check.names = FALSE)
View(pobre)
# Read db
pobre <- read.xlsx("data/Por_municipio_Nova_Sintese_Alunos_e_familias_pobres_contemplados_pelo_Bolsa_Merenda.xlsx", sep.names = " ")
ext_pobre <- read.xlsx("data/Por_municipio_Nova_Sintese_Alunos_e_familias_ext_pobres_contemplados_pelo_Bolsa_Merenda.xlsx", sep.names = " ")
mg_dados <- read.xlsx("data/mg_dados.xlsx") %>%
select(Código.IBGE, Município) %>%
rename(`Código IBGE` = Código.IBGE)
# Clean ext pobre
ext_pobre <- ext_pobre %>%
filter(!is.na(`Código IBGE`))
# Original
munic <- read_csv("data/dados_por_municipio.csv")
# Select variaveis
geral <- ext_pobre %>%
left_join(pobre, by = c("Código IBGE" = "Código.IBGE"), suffix = c("", "_2")) %>%
select(3,1,2, 5, 7, 17, 24, 26, 36, 6, 9, 18, 25, 28, 37, 38, 19, 38) %>%
mutate(across(everything(), ~replace_na(., 0)),
`Valor repassado aos beneficiários` = `Total de dinheiro repassado aos beneficiários da lista atual de extremamente pobres` + total_dinheiro_lista_atual) %>%
select(-c(16, 17)) %>%
left_join(mg_dados, by = "Código IBGE", suffix = c("", "_2")) %>%
mutate(Município = Município_2) %>%
select(-Município_2)
View(mg_dados)
mg_dados <- read.xlsx("data/mg_dados.xlsx") %>%
select(Código.IBGE, Município) %>%
rename(`Código IBGE` = Código.IBGE)
# Clean ext pobre
ext_pobre <- ext_pobre %>%
filter(!is.na(`Código IBGE`))
# Original
munic <- read_csv("data/dados_por_municipio.csv")
# Select variaveis
geral <- ext_pobre %>%
left_join(pobre, by = c("Código IBGE" = "Código.IBGE"), suffix = c("", "_2")) %>%
select(3,1,2, 5, 7, 17, 24, 26, 36, 6, 9, 18, 25, 28, 37, 38, 19, 38) %>%
mutate(across(everything(), ~replace_na(., 0)),
`Valor repassado aos beneficiários` = `Total de dinheiro repassado aos beneficiários da lista atual de extremamente pobres` + total_dinheiro_lista_atual) %>%
select(-c(16, 17)) %>%
left_join(mg_dados, by = "Código IBGE", suffix = c("", "_2")) %>%
mutate(Município = Município_2) %>%
select(-Município_2)
View(pobre)
View(ext_pobre)
names(pobre)
names(ext_pobre)
# Select variaveis
geral <- ext_pobre %>%
left_join(pobre, by = c("Código IBGE" = "Código.IBGE"), suffix = c("", "_2")) #%>%
# Select variaveis
geral <- ext_pobre %>%
left_join(pobre, by = "Código IBGE", suffix = c("", "_2")) %>%
select(3,1,2, 5, 7, 17, 24, 26, 36, 6, 9, 18, 25, 28, 37, 38, 19, 38) %>%
mutate(across(everything(), ~replace_na(., 0)),
`Valor repassado aos beneficiários` = `Total de dinheiro repassado aos beneficiários da lista atual de extremamente pobres` + total_dinheiro_lista_atual) %>%
select(-c(16, 17)) %>%
left_join(mg_dados, by = "Código IBGE", suffix = c("", "_2")) %>%
mutate(Município = Município_2) %>%
select(-Município_2)
# Select variaveis
geral <- ext_pobre %>%
left_join(pobre, by = "Código IBGE", suffix = c("", "_2"))# %>%
# Select variaveis
geral <- ext_pobre %>%
left_join(pobre, by = "Código IBGE", suffix = c("", "_2")) %>%
select(3,1,2, 5, 7, 17, 24, 26, 36, 6, 9, 18, 25, 28, 37, 38, 19, 38) #%>%
# Select variaveis
geral <- ext_pobre %>%
left_join(pobre, by = "Código IBGE", suffix = c("", "_2")) %>%
select(3,1,2, 5, 7, 17, 24, 26, 36, 6, 9, 18, 25, 28, 37, 38, 19, 38) %>%
mutate(across(everything(), ~replace_na(., 0)),
`Valor repassado aos beneficiários` = `Total de dinheiro repassado aos beneficiários da lista atual de extremamente pobres` + total_dinheiro_lista_atual) %>%
select(-c(16, 17)) %>%
left_join(mg_dados, by = "Código IBGE", suffix = c("", "_2")) %>%
mutate(Município = Município_2) %>%
select(-Município_2)
# Select variaveis
geral <- ext_pobre %>%
left_join(pobre, by = "Código IBGE", suffix = c("", "_2")) %>%
select(3,1,2, 5, 7, 17, 24, 26, 36, 6, 9, 18, 25, 28, 37, 38, 19, 38) %>%
mutate(across(everything(), ~replace_na(., 0)),
`Valor repassado aos beneficiários` = `Total de dinheiro repassado aos beneficiários da lista atual de extremamente pobres` + total_dinheiro_lista_atual) %>%
select(-c(16, 17)) #%>%
# Select variaveis
geral <- ext_pobre %>%
left_join(pobre, by = "Código IBGE", suffix = c("", "_2")) %>%
select(3,1,2, 5, 7, 17, 24, 26, 36, 6, 9, 18, 25, 28, 37, 38, 19, 38) %>%
mutate(across(everything(), ~replace_na(., 0)),
`Valor repassado aos beneficiários` = `Total de dinheiro repassado aos beneficiários da lista atual de extremamente pobres` + total_dinheiro_lista_atual) %>%
select(-c(16, 17)) #%>%
View(pobre)
